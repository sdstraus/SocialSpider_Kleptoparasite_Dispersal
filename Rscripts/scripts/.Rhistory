long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
else if(long.dat$site[i] == "ViaLoreto"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
else if(long.dat$site[i] == "JatunSacha"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
}
long.dat <- long.dat %>% mutate(ind.num2 = as.numeric(ind.num))
long.dat$ind.num2 <- if_else(long.dat$ind.num2 < 1.0, true = (long.dat$ind.num2*10), false = long.dat$ind.num2)
long.dat <- long.dat %>% mutate(ind.num2 = as.character(ind.num2))
exi.admix <-  ggplot(long.dat, aes(x=ind.num2, y=fraction, fill=Kclust)) +
geom_bar(stat="identity", position="stack") +
facet_grid(. ~ site + nest, drop=TRUE, space="free", scales="free")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(fill = "K cluster", y = "Ancestry", x = "Individual")
exi.admix
exi.admix15 <-  ggplot(long.dat, aes(x=ind.num2, y=fraction, fill=Kclust)) +
geom_bar(stat="identity", position="stack") +
facet_grid(. ~ site + nest, drop=TRUE, space="free", scales="free")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(fill = "K cluster", y = "Ancestry", x = "Individual")
exi.admix15
## K = 6 ##
long.dat <- exi.df %>% pivot_longer(cols = V1:V6, names_to = "Kclust", values_to = "fraction", names_prefix = "V")
# trim "Exi_Archi" off nest names
long.dat <- long.dat %>% mutate(nest = str_remove(nest, "Exi_Archi_"))
# trim "Exi_VL" off nest names
long.dat <- long.dat %>% mutate(nest = str_remove(nest, "Exi_VL_"))
# _JS
long.dat <- long.dat %>% mutate(nest = str_remove(nest, "_JS"))
# get individual #
long.dat$ind.num <- 0
for(i in 1:length(long.dat$site)){
if(long.dat$site[i] == "Archidona"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
else if(long.dat$site[i] == "ViaLoreto"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
else if(long.dat$site[i] == "JatunSacha"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
}
long.dat <- long.dat %>% mutate(ind.num2 = as.numeric(ind.num))
long.dat$ind.num2 <- if_else(long.dat$ind.num2 < 1.0, true = (long.dat$ind.num2*10), false = long.dat$ind.num2)
long.dat <- long.dat %>% mutate(ind.num2 = as.character(ind.num2))
exi.admix15 <-  ggplot(long.dat, aes(x=ind.num2, y=fraction, fill=Kclust)) +
geom_bar(stat="identity", position="stack") +
facet_grid(. ~ site + nest, drop=TRUE, space="free", scales="free")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(fill = "K cluster", y = "Ancestry", x = "Individual")
exi.admix15
### exi - js ####
CVs <- read.table("../../admixture/exi_js/CV.csv", sep = " ")
## K = 6 ##
long.dat <- exi.df %>% pivot_longer(cols = V1:V6, names_to = "Kclust", values_to = "fraction", names_prefix = "V")
# trim "Exi_Archi" off nest names
long.dat <- long.dat %>% mutate(nest = str_remove(nest, "Exi_Archi_"))
# trim "Exi_VL" off nest names
long.dat <- long.dat %>% mutate(nest = str_remove(nest, "Exi_VL_"))
# _JS
long.dat <- long.dat %>% mutate(nest = str_remove(nest, "_JS"))
# get individual #
long.dat$ind.num <- 0
for(i in 1:length(long.dat$site)){
if(long.dat$site[i] == "Archidona"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
else if(long.dat$site[i] == "ViaLoreto"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
else if(long.dat$site[i] == "JatunSacha"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
}
long.dat <- long.dat %>% mutate(ind.num2 = as.numeric(ind.num))
long.dat$ind.num2 <- if_else(long.dat$ind.num2 < 1.0, true = (long.dat$ind.num2*10), false = long.dat$ind.num2)
long.dat <- long.dat %>% mutate(ind.num2 = as.character(ind.num2))
exi.admix6 <-  ggplot(long.dat, aes(x=ind.num2, y=fraction, fill=Kclust)) +
geom_bar(stat="identity", position="stack") +
facet_grid(. ~ site + nest, drop=TRUE, space="free", scales="free")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(fill = "K cluster", y = "Ancestry", x = "Individual")
exi.admix6
popmap <-  read.table("../../pop_maps/eximius_popmap_colony_site_cluster.txt", sep = '\t', header = FALSE)
popmap <- popmap %>% rename("ind" = "V1", "site" = "V2", "nest" = "V4", "cluster" = "V3")
head(popmap)
names <-gl.exi@ind.names
names2 <- popmap$ind
difference <- setdiff(names2, names)
for(i in 1:length(popmap$ind)){
for(j in 1:length(difference)){
if(popmap$ind[i] == difference[j]){
popmap <- popmap[-i,]
}
}
}
for(i in 1:length(popmap$ind)){
for(j in 1:length(difference)){
if(popmap$ind[i] == difference[j]){
popmap <- popmap[-i,]
}
}
}
exi.df <- cbind(popmap, tbl)
rows <- which(exi.df$ind == "Exi_VL_9.5.01")
exi.df <- exi.df[-rows,]
## K = 6 ##
long.dat <- exi.df %>% pivot_longer(cols = V1:V6, names_to = "Kclust", values_to = "fraction", names_prefix = "V")
# trim "Exi_Archi" off nest names
long.dat <- long.dat %>% mutate(nest = str_remove(nest, "Exi_Archi_"))
# trim "Exi_VL" off nest names
long.dat <- long.dat %>% mutate(nest = str_remove(nest, "Exi_VL_"))
# _JS
long.dat <- long.dat %>% mutate(nest = str_remove(nest, "_JS"))
# get individual #
long.dat$ind.num <- 0
for(i in 1:length(long.dat$site)){
if(long.dat$site[i] == "Archidona"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
else if(long.dat$site[i] == "ViaLoreto"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
else if(long.dat$site[i] == "JatunSacha"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
}
long.dat <- long.dat %>% mutate(ind.num2 = as.numeric(ind.num))
long.dat$ind.num2 <- if_else(long.dat$ind.num2 < 1.0, true = (long.dat$ind.num2*10), false = long.dat$ind.num2)
long.dat <- long.dat %>% mutate(ind.num2 = as.character(ind.num2))
exi.admix6 <-  ggplot(long.dat, aes(x=ind.num2, y=fraction, fill=Kclust)) +
geom_bar(stat="identity", position="stack") +
facet_grid(. ~ site + nest, drop=TRUE, space="free", scales="free")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(fill = "K cluster", y = "Ancestry", x = "Individual")
exi.admix6
## K = 6 ##
long.dat <- exi.df %>% pivot_longer(cols = V1:V6, names_to = "Kclust", values_to = "fraction", names_prefix = "V")
exi.df <- cbind(popmap, tbl)
rows <- which(exi.df$ind == "Exi_VL_9.5.01")
exi.df <- exi.df[-rows,]
View(exi.df)
## K = 6 ##
long.dat <- exi.df %>% pivot_longer(cols = V1:V6, names_to = "Kclust", values_to = "fraction", names_prefix = "V")
## K = 6 ##
long.dat <- exi.df %>% pivot_longer(cols = V1:V6, names_to = "Kclust", values_to = "fraction", names_prefix = "V")
library(stringr)
library(vcfR)
library(adegenet)
library(SNPRelate)
library(tidyverse)
library(hierfstat)
library(poppr)
library(dartR)
## K = 6 ##
tbl=read.table("../../admixture/exi/exi.scaffolds.6.Q")
barplot(t(as.matrix(tbl)), col=getPalette(15), xlab="Individual", ylab="Ancestry", border=NA)
popmap <-  read.table("../../pop_maps/eximius_popmap_colony_site_cluster.txt", sep = '\t', header = FALSE)
popmap <- popmap %>% rename("ind" = "V1", "site" = "V2", "nest" = "V4", "cluster" = "V3")
head(popmap)
names <-gl.exi@ind.names
names2 <- popmap$ind
difference <- setdiff(names2, names)
for(i in 1:length(popmap$ind)){
for(j in 1:length(difference)){
if(popmap$ind[i] == difference[j]){
popmap <- popmap[-i,]
}
}
}
for(i in 1:length(popmap$ind)){
for(j in 1:length(difference)){
if(popmap$ind[i] == difference[j]){
popmap <- popmap[-i,]
}
}
}
exi.df <- cbind(popmap, tbl)
rows <- which(exi.df$ind == "Exi_VL_9.5.01")
exi.df <- exi.df[-rows,]
long.dat <- exi.df %>% pivot_longer(cols = V1:V6, names_to = "Kclust", values_to = "fraction", names_prefix = "V")
# trim "Exi_Archi" off nest names
long.dat <- long.dat %>% mutate(nest = str_remove(nest, "Exi_Archi_"))
# trim "Exi_VL" off nest names
long.dat <- long.dat %>% mutate(nest = str_remove(nest, "Exi_VL_"))
# _JS
long.dat <- long.dat %>% mutate(nest = str_remove(nest, "_JS"))
# get individual #
long.dat$ind.num <- 0
for(i in 1:length(long.dat$site)){
if(long.dat$site[i] == "Archidona"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
else if(long.dat$site[i] == "ViaLoreto"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
else if(long.dat$site[i] == "JatunSacha"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
}
long.dat <- long.dat %>% mutate(ind.num2 = as.numeric(ind.num))
long.dat$ind.num2 <- if_else(long.dat$ind.num2 < 1.0, true = (long.dat$ind.num2*10), false = long.dat$ind.num2)
long.dat <- long.dat %>% mutate(ind.num2 = as.character(ind.num2))
exi.admix6 <-  ggplot(long.dat, aes(x=ind.num2, y=fraction, fill=Kclust)) +
geom_bar(stat="identity", position="stack") +
facet_grid(. ~ site + nest, drop=TRUE, space="free", scales="free")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(fill = "K cluster", y = "Ancestry", x = "Individual")
exi.admix6
exi.admix15
tbl=read.table("../../admixture/exi/exi.scaffolds.15.Q")
barplot(t(as.matrix(tbl)), col=getPalette(15), xlab="Individual", ylab="Ancestry", border=NA)
popmap <-  read.table("../../pop_maps/eximius_popmap_colony_site_cluster.txt", sep = '\t', header = FALSE)
popmap <- popmap %>% rename("ind" = "V1", "site" = "V2", "nest" = "V4", "cluster" = "V3")
head(popmap)
names <-gl.exi@ind.names
names2 <- popmap$ind
difference <- setdiff(names2, names)
for(i in 1:length(popmap$ind)){
for(j in 1:length(difference)){
if(popmap$ind[i] == difference[j]){
popmap <- popmap[-i,]
}
}
}
for(i in 1:length(popmap$ind)){
for(j in 1:length(difference)){
if(popmap$ind[i] == difference[j]){
popmap <- popmap[-i,]
}
}
}
exi.df <- cbind(popmap, tbl)
rows <- which(exi.df$ind == "Exi_VL_9.5.01")
exi.df <- exi.df[-rows,]
long.dat <- exi.df %>% pivot_longer(cols = V1:V15, names_to = "Kclust", values_to = "fraction", names_prefix = "V")
# trim "Exi_Archi" off nest names
long.dat <- long.dat %>% mutate(nest = str_remove(nest, "Exi_Archi_"))
# trim "Exi_VL" off nest names
long.dat <- long.dat %>% mutate(nest = str_remove(nest, "Exi_VL_"))
# _JS
long.dat <- long.dat %>% mutate(nest = str_remove(nest, "_JS"))
# get individual #
long.dat$ind.num <- 0
for(i in 1:length(long.dat$site)){
if(long.dat$site[i] == "Archidona"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
else if(long.dat$site[i] == "ViaLoreto"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
else if(long.dat$site[i] == "JatunSacha"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
}
long.dat <- long.dat %>% mutate(ind.num2 = as.numeric(ind.num))
long.dat$ind.num2 <- if_else(long.dat$ind.num2 < 1.0, true = (long.dat$ind.num2*10), false = long.dat$ind.num2)
long.dat <- long.dat %>% mutate(ind.num2 = as.character(ind.num2))
exi.admix15 <-  ggplot(long.dat, aes(x=ind.num2, y=fraction, fill=Kclust)) +
geom_bar(stat="identity", position="stack") +
facet_grid(. ~ site + nest, drop=TRUE, space="free", scales="free")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(fill = "K cluster", y = "Ancestry", x = "Individual")
exi.admix15
ggpubr::ggarrange(exi.admix6, exi.admix15, nrow = 2)
exi.admix.site.level <- ggpubr::ggarrange(exi.admix6, exi.admix15, nrow = 2)
?ggsave
ggsave(exi.admix.site.level, filename = "../figures/exi.admix.site.level.jpeg", dpi = retina,
units = "in", width = 8, heigh = 8)
ggsave(exi.admix.site.level, filename = "../figures/exi.admix.site.level.jpeg", dpi = "retina",
units = "in", width = 8, heigh = 8)
ggsave(exi.admix.site.level, filename = "../../figures/exi.admix.site.level.jpeg", dpi = "retina",
units = "in", width = 10, height = 8)
ggsave(exi.admix.site.level, filename = "../../figures/exi.admix.site.level.jpeg", dpi = "retina",
units = "in", width = 12, height = 10)
ggpubr::ggarrange(exi.js.admix, exi.archi.admix, exi.vl.admix, nrow=3)
exi.within.site <- ggpubr::ggarrange(exi.js.admix, exi.archi.admix, exi.vl.admix, nrow=3)
ggsave(exi.within.site, filename = "../../figures/exi.within.site.jpeg", dpi = "retina",
units = "in", width = 10, height = 8)
### f1 - js ####
CVs <- read.table("../../admixture/f1_js/CV.csv", sep = " ")
CVs <- CVs[, 3:4] ## drop the first two columns
## Remove the formatting around the K values:
CVs[, 1] <- gsub(x = CVs[, 1], pattern = "\\(K=",
replacement = "")
CVs[, 1] <- gsub(x = CVs[, 1], pattern = "\\):",
replacement = "")
head(CVs)
plot(CVs, xlab = "K", ylab = "A. eximius CV error")
abline(v = c(4, 5))
plot(CVs, xlab = "K", ylab = "A. eximius CV error")
abline(v = c(4, 7)) #sample size probs too low for 7
tbl=read.table("../../admixture/f1_js/f1_js_subset.4.Q")
barplot(t(as.matrix(tbl)), col=brewer.pal(6, "Dark2"), xlab="Individual", ylab="Ancestry", border=NA)
library(RColorBrewer)
barplot(t(as.matrix(tbl)), col=brewer.pal(6, "Dark2"), xlab="Individual", ylab="Ancestry", border=NA)
popmap <-  read.table("../../pop_maps/eximius_popmap_colony_site_cluster.txt", sep = '\t', header = FALSE)
popmap <- popmap %>% rename("ind" = "V1", "site" = "V2", "nest" = "V3", "cluster" = "V4") %>%
filter(site == "JatunSacha")
head(popmap)
names <-exi.js@ind.names
names2 <- popmap$ind
difference <- setdiff(names2, names)
for(i in 1:length(popmap$ind)){
for(j in 1:length(difference)){
if(popmap$ind[i] == difference[j]){
popmap <- popmap[-i,]
}
}
}
names <-n1.js@ind.names
#
gl.n1 <- readRDS("../rds/gl.n1.RDS")
#JS
setPop(gl.n1) <- ~Site
popNames(gl.n1)
n1.js <- popsub(gl.n1, "JatunSacha")
popNames(n1.js)
setPop(n1.js) <- ~Nest
indNames(n1.js)
# remove NAs
toRemove <- is.na(glMean(n1.js, alleleAsUnit = FALSE))
which(toRemove)
n1.js <- n1.js[, !toRemove]
names <-n1.js@ind.names
popmap <-  read.table("../../pop_maps/n1_popmap_colony_site_cluster.txt", sep = '\t', header = FALSE)
popmap <- popmap %>% rename("ind" = "V1", "site" = "V2", "nest" = "V3", "cluster" = "V4") %>%
filter(site == "JatunSacha")
head(popmap)
names <-n1.js@ind.names
names2 <- popmap$ind
difference <- setdiff(names2, names)
for(i in 1:length(popmap$ind)){
for(j in 1:length(difference)){
if(popmap$ind[i] == difference[j]){
popmap <- popmap[-i,]
}
}
}
for(j in 1:length(difference)){
if(popmap$ind[i] == difference[j]){
popmap <- popmap[-i,]
}
}
for(i in 1:length(popmap$ind)){
for(j in 1:length(difference)){
if(popmap$ind[i] == difference[j]){
popmap <- popmap[-i,]
}
}
}
head(popmap)
popmap <-  read.table("../../pop_maps/n1_popmap_colony_site_cluster.txt", sep = '\t', header = FALSE)
popmap <- popmap %>% rename("ind" = "V1", "site" = "V2", "nest" = "V3", "cluster" = "V4") %>%
filter(site == "JatunSacha")
head(popmap)
popmap <-  read.table("../../pop_maps/n1_popmap_colony_site_cluster.txt", sep = '\t', header = FALSE)
View(popmap)
popmap <- popmap %>% rename("ind" = "V1", "site" = "V4", "nest" = "V2", "cluster" = "V3") %>%
filter(site == "JatunSacha")
head(popmap)
names <-n1.js@ind.names
names2 <- popmap$ind
difference <- setdiff(names2, names)
for(i in 1:length(popmap$ind)){
for(j in 1:length(difference)){
if(popmap$ind[i] == difference[j]){
popmap <- popmap[-i,]
}
}
}
for(i in 1:length(popmap$ind)){
for(j in 1:length(difference)){
if(popmap$ind[i] == difference[j]){
popmap <- popmap[-i,]
}
}
}
exi.js.df <- cbind(popmap, tbl)
f1.js.df <- cbind(popmap, tbl)
long.f1.js <- f1.js.df %>% pivot_longer(cols = V1:V4, names_to = "Kclust", values_to = "fraction", names_prefix = "V")
# trim column names
long.f1.js <- long.f1.js %>%
mutate(nest = str_sub(nest,0,5)) %>%
mutate(ind.num = str_sub(ind, -2))
View(long.f1.js)
long.f1.js <- long.f1.js %>% mutate(ind.num2 = as.numeric(ind.num))
long.f1.js$ind.num2 <- if_else(long.f1.js$ind.num2 < 1.0, true = (long.f1.js$ind.num2*10), false = long.f1.js$ind.num2)
# also, 06A and 06B naming is causing issues
rows <- which(str_detect(long.dat.js$ind, "06A"))
long.dat.js$ind.num2[rows] <- paste(long.dat.js$ind.num2[rows], "A", sep = "")
# also, 06A and 06B naming is causing issues
rows <- which(str_detect(long.f1.js$ind, "06A"))
rows <- which(str_detect(long.f1.js$ind, "06B"))
which(str_detect(long.f1.js$ind, "06B"))
long.f1.js$ind.num2[rows] <- paste(long.f1.js$ind.num2[rows], "B", sep = "")
long.f1.js <- long.f1.js %>% mutate(ind.num2 = as.character(ind.num2))
exi.js.admix <-  ggplot(long.dat.js, aes(x=ind.num2, y=fraction, fill=Kclust)) +
geom_bar(stat="identity", position="stack") +
facet_grid(. ~ nest, drop=TRUE, space="free", scales="free")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(fill = "K cluster", y = "Ancestry", x = "Individual")
f1.js.admix <-  ggplot(long.dat.js, aes(x=ind.num2, y=fraction, fill=Kclust)) +
geom_bar(stat="identity", position="stack") +
facet_grid(. ~ nest, drop=TRUE, space="free", scales="free")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(fill = "K cluster", y = "Ancestry", x = "Individual")
f1.js.admix <- exi.js.admix + scale_fill_brewer(palette="BrBG")
f1.js.admix
f1.js.admix <-  ggplot(long.f1.js, aes(x=ind.num2, y=fraction, fill=Kclust)) +
geom_bar(stat="identity", position="stack") +
facet_grid(. ~ nest, drop=TRUE, space="free", scales="free")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(fill = "K cluster", y = "Ancestry", x = "Individual")
f1.js.admix <- exi.js.admix + scale_fill_brewer(palette="BrBG")
f1.js.admix
f1.js.admix <-  ggplot(long.f1.js, aes(x=ind.num2, y=fraction, fill=Kclust)) +
geom_bar(stat="identity", position="stack") +
facet_grid(. ~ nest, drop=TRUE, space="free", scales="free")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(fill = "K cluster", y = "Ancestry", x = "Individual")
f1.js.admix <- f1.js.admix + scale_fill_brewer(palette="BrBG")
f1.js.admix
f1.js.admix <-  ggplot(long.f1.js, aes(x=ind.num2, y=fraction, fill=Kclust)) +
geom_bar(stat="identity", position="stack") +
facet_grid(. ~ nest, drop=TRUE, space="free", scales="free")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(fill = "K cluster", y = "Ancestry", x = "Individual")
f1.js.admix
tbl=read.table("../../admixture/n1/f1.scaffolds.5.Q")
tbl=read.table("../../admixture/n1/f1.scaffolds.5.Q")
tbl=read.table("../../admixture/f1/f1.scaffolds.5.Q")
barplot(t(as.matrix(tbl)), col=brewer.pal(6, "Dark2"), xlab="Individual", ylab="Ancestry", border=NA)
popmap <-  read.table("../../pop_maps/n1_popmap_colony_site_cluster.txt", sep = '\t', header = FALSE)
popmap <- popmap %>% rename("ind" = "V1", "nest" = "V2", "cluster" = "V3", "site" = "V4")
head(popmap)
names <-gl.n1@ind.names
names2 <- popmap$ind
difference <- setdiff(names2, names)
for(i in 1:length(popmap$ind)){
for(j in 1:length(difference)){
if(popmap$ind[i] == difference[j]){
popmap <- popmap[-i,]
}
}
}
for(i in 1:length(popmap$ind)){
for(j in 1:length(difference)){
if(popmap$ind[i] == difference[j]){
popmap <- popmap[-i,]
}
}
}
f1.df <- cbind(popmap, tbl)
long.dat <- f1.df %>% pivot_longer(cols = V1:V5, names_to = "Kclust", values_to = "fraction", names_prefix = "V")
f1.admix <-  ggplot(long.dat, aes(x=ind, y=fraction, fill=Kclust)) +
geom_bar(stat="identity", position="stack") +
facet_grid(. ~ site, drop=TRUE, space="free", scales="free")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(fill = "K cluster", y = "Ancestry", x = "Individual")
f1.admix
rows <- which(f1.df$ind == "Exi_VL_9.5.01")
long.dat <- f1.df %>% pivot_longer(cols = V1:V5, names_to = "Kclust", values_to = "fraction", names_prefix = "V")
# trim "Exi_Archi" off nest names
long.dat <- long.dat %>% mutate(nest = str_remove(nest, "Exi_Archi_"))
# trim "Exi_VL" off nest names
long.dat <- long.dat %>% mutate(nest = str_remove(nest, "Exi_VL_"))
# _JS
long.dat <- long.dat %>% mutate(nest = str_remove(nest, "_JS"))
# get individual #
long.dat$ind.num <- 0
for(i in 1:length(long.dat$site)){
if(long.dat$site[i] == "Archidona"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
else if(long.dat$site[i] == "ViaLoreto"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
else if(long.dat$site[i] == "JatunSacha"){
long.dat$ind.num[i] <- str_sub(long.dat$ind[i], -2)
}
}
long.dat <- long.dat %>% mutate(ind.num2 = as.numeric(ind.num))
long.dat$ind.num2 <- if_else(long.dat$ind.num2 < 1.0, true = (long.dat$ind.num2*10), false = long.dat$ind.num2)
long.dat <- long.dat %>% mutate(ind.num2 = as.character(ind.num2))
f1.admix <-  ggplot(long.dat, aes(x=ind, y=fraction, fill=Kclust)) +
geom_bar(stat="identity", position="stack") +
facet_grid(. ~ site, drop=TRUE, space="free", scales="free")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(fill = "K cluster", y = "Ancestry", x = "Individual")
f1.admix
f1.admix <-  ggplot(long.dat, aes(x=ind2, y=fraction, fill=Kclust)) +
geom_bar(stat="identity", position="stack") +
facet_grid(. ~ site + nest, drop=TRUE, space="free", scales="free")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(fill = "K cluster", y = "Ancestry", x = "Individual")
f1.admix
f1.admix <-  ggplot(long.dat, aes(x=ind.num2, y=fraction, fill=Kclust)) +
geom_bar(stat="identity", position="stack") +
facet_grid(. ~ site + nest, drop=TRUE, space="free", scales="free")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(fill = "K cluster", y = "Ancestry", x = "Individual")
f1.admix
f1.admix.plots <- ggpubr::ggarrange(f1.admix, f1.js.admix, nrow=2)
ggsave(f1.admix.plots, filename = "../../figures/f1.admix.plots.jpeg", dpi = "retina",
units = "in", width = 10, height = 8)
exi.within.site <- ggpubr::ggarrange(exi.admix6, exi.js.admix, exi.archi.admix, exi.vl.admix, nrow=4)
ggsave(exi.within.site, filename = "../../figures/exi.within.site.jpeg", dpi = "retina",
units = "in", width = 10, height = 11)
